<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø­Ø¨Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø© Ø£Ø·ÙŠØ§Ù Ø­Ø³Ù†</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --dark-bg: #0a0a0a; --card-bg: #121212; }
        body { background: var(--dark-bg); color: white; font-family: 'Tajawal', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 15px; box-sizing: border-box; }
        .container { background: var(--card-bg); padding: 25px; border-radius: 20px; width: 100%; max-width: 400px; text-align: center; border: 1px solid var(--gold); box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); }
        .header-box { background: var(--gold); color: black; padding: 12px; border-radius: 12px; font-weight: bold; margin-bottom: 20px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .upload-area { border: 2px dashed #444; padding: 30px 10px; border-radius: 15px; cursor: pointer; margin-bottom: 20px; background: #1a1a1a; }
        #preview-img { max-width: 100%; max-height: 150px; display: none; margin: 15px auto; border-radius: 8px; border: 1px solid var(--gold); }
        .form-group { text-align: right; margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; color: var(--gold); font-size: 0.9rem; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #1a1a1a; color: white; box-sizing: border-box; font-family: 'Tajawal'; }
        .btn { background: var(--gold); color: black; border: none; padding: 14px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn:disabled { background: #555; cursor: not-allowed; opacity: 0.7; }
        #status-msg { margin-top: 15px; color: var(--gold); font-size: 0.9rem; display: none; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--gold); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-left: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø© Ø£Ø·ÙŠØ§Ù Ø­Ø³Ù†</div>

    <div id="step1" class="page active">
        <h3>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h3>
        <p style="font-size: 0.85rem; color: #aaa;">Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ØªØ«Ø¨Øª Ù…ØªØ§Ø¨Ø¹ØªÙƒ Ù„ØªÙŠÙƒ ØªÙˆÙƒ (Screenshot)</p>
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <span id="file-label">ğŸ“¸ Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø©</span>
            <input type="file" id="fileInput" accept="image/*" hidden>
            <img id="preview-img">
        </div>
        <button id="verifyBtn" class="btn" onclick="startOCR()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„ØªØ­Ù‚Ù‚</button>
        <div id="status-msg"><div class="loader"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø°ÙƒÙŠØ§Ù‹...</div>
    </div>

    <div id="step2" class="page">
        <h3 style="color:var(--gold)">ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ âœ…</h3>
        <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³Ø­Ø¨Ø©</p>
        <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ:</label><input type="text" id="userName"></div>
        <div class="form-group">
            <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label>
            <select id="userCity">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
                <option>Ø¨ØºØ¯Ø§Ø¯</option><option>Ø§Ù„Ø¨ØµØ±Ø©</option><option>Ù†ÙŠÙ†ÙˆÙ‰</option><option>Ø£Ø±Ø¨ÙŠÙ„</option><option>Ø§Ù„Ù†Ø¬Ù</option><option>ÙƒØ±Ø¨Ù„Ø§Ø¡</option><option>Ø°ÙŠ Ù‚Ø§Ø±</option><option>Ø¨Ø§Ø¨Ù„</option><option>ÙƒØ±ÙƒÙˆÙƒ</option><option>Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option><option>Ø¯ÙŠØ§Ù„Ù‰</option><option>Ø§Ù„Ù…Ø«Ù†Ù‰</option><option>Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©</option><option>Ù…ÙŠØ³Ø§Ù†</option><option>ÙˆØ§Ø³Ø·</option><option>ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†</option><option>Ø¯Ù‡ÙˆÙƒ</option><option>Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option>
            </select>
        </div>
        <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label><input type="tel" id="userPhone" placeholder="07XXXXXXXX" dir="ltr"></div>
        <button id="submitBtn" class="btn" onclick="sendToSheet()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

    <div id="step3" class="page">
        <h1 style="font-size: 3rem;">ğŸ‰</h1>
        <h2 style="color: var(--gold);">ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
        <p>Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØ±Ø².</p>
        <button class="btn" style="background:#333; color:white;" onclick="location.reload()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const previewImg = document.getElementById('preview-img');
    const statusMsg = document.getElementById('status-msg');
    const verifyBtn = document.getElementById('verifyBtn');

    fileInput.onchange = function() {
        if (this.files[0]) {
            document.getElementById('file-label').style.display = 'none';
            const reader = new FileReader();
            reader.onload = e => { previewImg.src = e.target.result; previewImg.style.display = 'block'; }
            reader.readAsDataURL(this.files[0]);
        }
    };

    async function startOCR() {
        if (!fileInput.files[0]) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©");

        verifyBtn.disabled = true;
        statusMsg.style.display = "block";

        try {
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù„ØºØªÙŠÙ† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            const worker = await Tesseract.createWorker();
            await worker.loadLanguage('ara+eng');
            await worker.initialize('ara+eng');
            
            const { data: { text } } = await worker.recognize(fileInput.files[0]);
            await worker.terminate();

            console.log("Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙƒØªØ´Ù:", text); // Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙŠ Ø§Ù„Ù€ Console

            // Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ¤ÙƒØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
            const keywords = ['following', 'message', 'friends', 'Ù…ØªØ§Ø¨Ø¹Ø©', 'Ø±Ø³Ø§Ù„Ø©', 'Ø£ØµØ¯Ù‚Ø§Ø¡', 'tiktok', 'atyaf'];
            const isMatch = keywords.some(key => text.toLowerCase().includes(key));

            if (isMatch) {
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step2').classList.add('active');
            } else {
                alert("ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©. ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø¯Ø§Ø®Ù„ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø© ÙˆØ£Ù† ÙƒÙ„Ù…Ø© (Ù…ØªØ§Ø¨Ø¹Ø©) Ø¸Ø§Ù‡Ø±Ø©.");
                verifyBtn.disabled = false;
                statusMsg.style.display = "none";
            }
        } catch (error) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ. ØªØ£ÙƒØ¯ Ù…Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            verifyBtn.disabled = false;
            statusMsg.style.display = "none";
        }
    }

    async function sendToSheet() {
        const name = document.getElementById('userName').value;
        const city = document.getElementById('userCity').value;
        const phone = document.getElementById('userPhone').value;
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw5LThYfl6XPd7eRYWQWV28kE2jjx9LI8HGq9UXceG_G26pK20ljpMuRMZIx466mYjejQ/exec';

        if (!name || !city || !phone) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

        try {
            await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ name, city, phone }) });
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
        } catch (e) {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
        }
    }
</script>

</body>
</html>
